<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Lean Management ‚Äì 5S Spiel (√úberarbeitet)</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body {
    font-family: Arial, sans-serif;
    text-align: center;
    background: #f5f5f5;
    margin: 0;
    padding: 20px;
  }
  h1 { margin-bottom: 10px; }
  #grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));
    gap: 6px;
    justify-content: center;
    max-width: 500px;
    margin: 20px auto;
  }
  button {
    width: 12vw;
    height: 12vw;
    max-width: 70px;
    max-height: 70px;
    font-size: 3vw;
    border: 1px solid #aaa;
    border-radius: 8px;
    cursor: pointer;
    background: white;
    touch-action: manipulation;
  }
  #controls {
    display: flex;
    justify-content: center;
    gap: 10px;
    flex-wrap: wrap;
  }
  #info {
    margin-top: 10px;
    padding: 8px;
    background: #e0e0e0;
    border-radius: 6px;
    width: 80%;
    margin-left: auto;
    margin-right: auto;
  }
  #result {
    font-weight: bold;
    margin-top: 15px;
  }
</style>
</head>
<body>

<h1>Lean Management ‚Äì 5S Trainingsspiel (Neue Version)</h1>
<h2 id="stageTitle">Stufe 0 ‚Äì Farbenchaos</h2>
<p id="info">Klicke die Zahlen 1 bis 64 in der richtigen Reihenfolge.</p>
<p>Zeit: <span id="timer">0.0</span> s</p>

<div id="grid"></div>

<div id="controls">
  <button id="cleanBtn" style="display:none;">üßπ S√§ubern</button>
  <button id="sortBtn" style="display:none;">üî¢ Ordnen</button>
  <button id="nextStage" style="display:none;">‚û°Ô∏è Weiter</button>
</div>

<p id="result"></p>

<script>
const grid = document.getElementById("grid");
const timerDisplay = document.getElementById("timer");
const result = document.getElementById("result");
const nextBtn = document.getElementById("nextStage");
const cleanBtn = document.getElementById("cleanBtn");
const sortBtn = document.getElementById("sortBtn");
const stageTitle = document.getElementById("stageTitle");
const info = document.getElementById("info");

let stage = 0;
let timer, startTime;

function startTimer() {
  startTime = Date.now();
  timer = setInterval(() => {
    timerDisplay.textContent = ((Date.now() - startTime) / 1000).toFixed(1);
  }, 100);
}
function stopTimer() { clearInterval(timer); }

// Zufall und Farbgenerator
function shuffle(arr) { return arr.sort(() => Math.random() - 0.5); }
function randomColor() {
  return "hsl(" + Math.floor(Math.random() * 360) + ",80%,40%)";
}

// ---------- STUFE 0 ----------
function stage0() {
  stageTitle.textContent = "Stufe 0 ‚Äì Farbenchaos";
  info.textContent = "Klicke die Zahlen 1 bis 64 in richtiger Reihenfolge.";
  result.textContent = "";
  grid.innerHTML = "";
  nextBtn.style.display = "none";
  cleanBtn.style.display = "none";
  sortBtn.style.display = "none";

  let numbers = shuffle([...Array(64).keys()].map(x => x+1));
  let current = 1;
  numbers.forEach(n => {
    const b = document.createElement("button");
    b.textContent = n;
    b.style.color = randomColor();
    b.onclick = () => {
      if (current === 1 && !startTime) startTimer();
      if (n === current) {
        b.disabled = true;
        b.style.background = "#8f8";
        current++;
        if (current > 64) {
          stopTimer();
          result.textContent = `‚úÖ Fertig in ${((Date.now()-startTime)/1000).toFixed(2)}s`;
          nextBtn.style.display = "inline-block";
        }
      } else {
        b.style.background = "#f88";
      }
    };
    grid.appendChild(b);
  });
}

// ---------- STUFE 1 ----------
function stage1() {
  stageTitle.textContent = "Stufe 1 ‚Äì Reduktion";
  info.textContent = "Zahlen 41‚Äì64 aussortieren, dann mit 40 Zahlen weiterspielen.";
  result.textContent = "";
  grid.innerHTML = "";
  nextBtn.style.display = "none";

  let numbers = shuffle([...Array(64).keys()].map(x => x+1));
  numbers.forEach(n => {
    const b = document.createElement("button");
    b.textContent = n;
    b.onclick = () => {
      if (n >= 41) {
        b.disabled = true;
        b.style.background = "#f88";
      } else {
        b.disabled = true;
        b.style.background = "#8f8";
      }
      if ([...grid.children].filter(btn => !btn.disabled).length === 0) {
        // Jetzt das 40er Spiel starten
        setTimeout(() => stage0_reduced(), 1000);
      }
    };
    grid.appendChild(b);
  });
}

function stage0_reduced() {
  info.textContent = "Spiele mit 40 Zahlen in richtiger Reihenfolge.";
  grid.innerHTML = "";
  let numbers = shuffle([...Array(40).keys()].map(x => x+1));
  let current = 1;
  numbers.forEach(n => {
    const b = document.createElement("button");
    b.textContent = n;
    b.style.color = randomColor();
    b.onclick = () => {
      if (current === 1 && !startTime) startTimer();
      if (n === current) {
        b.disabled = true;
        b.style.background = "#8f8";
        current++;
        if (current > 40) {
          stopTimer();
          result.textContent = `‚úÖ Fertig in ${((Date.now()-startTime)/1000).toFixed(2)}s`;
          nextBtn.style.display = "inline-block";
        }
      }
    };
    grid.appendChild(b);
  });
}

// ---------- STUFE 2 ----------
function stage2() {
  stageTitle.textContent = "Stufe 2 ‚Äì Gruppierungen";
  info.textContent = "Zahlen 1‚Äì40 in farbige Gruppen an verschiedenen Positionen.";
  result.textContent = "";
  grid.innerHTML = "";
  nextBtn.style.display = "none";

  const colorGroups = ["#ff6961","#f8d66d","#77dd77","#779ecb"];
  const positions = [[],[],[],[]];
  let nums = [...Array(40).keys()].map(x=>x+1);
  nums.forEach(n => {
    let group = Math.floor((n-1)/10);
    positions[group].push(n);
  });
  let ordered = [...positions[0],...positions[1],...positions[2],...positions[3]];
  let shuffled = shuffle(ordered);

  let current = 1;
  shuffled.forEach(n => {
    const b = document.createElement("button");
    b.textContent = n;
    b.style.color = colorGroups[Math.floor((n-1)/10)];
    b.onclick = () => {
      if (current === 1 && !startTime) startTimer();
      if (n === current) {
        b.disabled = true;
        b.style.background = "#8f8";
        current++;
        if (current > 40) {
          stopTimer();
          result.textContent = `‚úÖ Fertig in ${((Date.now()-startTime)/1000).toFixed(2)}s`;
          nextBtn.style.display = "inline-block";
        }
      }
    };
    grid.appendChild(b);
  });
}

// ---------- STUFE 3 ----------
function stage3() {
  stageTitle.textContent = "Stufe 3 ‚Äì S√§uberung";
  info.textContent = "Klicke 'S√§ubern', um alle Schriftfarben zu vereinheitlichen, dann spiele erneut.";
  result.textContent = "";
  grid.innerHTML = "";
  nextBtn.style.display = "none";
  cleanBtn.style.display = "inline-block";
  sortBtn.style.display = "none";

  let numbers = shuffle([...Array(40).keys()].map(x => x+1));
  let current = 1;

  numbers.forEach(n => {
    const b = document.createElement("button");
    b.textContent = n;
    b.style.color = randomColor();
    grid.appendChild(b);
  });

  cleanBtn.onclick = () => {
    for (let b of grid.children) b.style.color = "#222";
    cleanBtn.style.display = "none";
    // Jetzt das normale Spiel starten
    startColorlessGame();
  };
}

function startColorlessGame() {
  let current = 1;
  for (let b of grid.children) {
    const n = parseInt(b.textContent);
    b.disabled = false;
    b.onclick = () => {
      if (current === 1 && !startTime) startTimer();
      if (n === current) {
        b.disabled = true;
        b.style.background = "#8f8";
        current++;
        if (current > 40) {
          stopTimer();
          result.textContent = `‚úÖ Fertig in ${((Date.now()-startTime)/1000).toFixed(2)}s`;
          nextBtn.style.display = "inline-block";
        }
      } else {
        b.style.background = "#f88";
      }
    };
  }
}

// ---------- STUFE 4 ----------
function stage4() {
  stageTitle.textContent = "Stufe 4 ‚Äì Standardisieren";
  info.textContent = "Klicke 'Ordnen', um alle Zahlen zu sortieren, dann spiele ein letztes Mal.";
  result.textContent = "";
  grid.innerHTML = "";
  nextBtn.style.display = "none";
  sortBtn.style.display = "inline-block";
  cleanBtn.style.display = "none";

  let numbers = shuffle([...Array(40).keys()].map(x => x+1));
  numbers.forEach(n => {
    const b = document.createElement("button");
    b.textContent = n;
    b.style.color = "#333";
    grid.appendChild(b);
  });

  sortBtn.onclick = () => {
    grid.innerHTML = "";
    for (let i=1;i<=40;i++) {
      const b = document.createElement("button");
      b.textContent = i;
      b.style.color = "#333";
      b.onclick = () => {
        if (i === 1 && !startTime) startTimer();
        if (i === current) {
          b.disabled = true;
          b.style.background = "#8f8";
          current++;
          if (current > 40) {
            stopTimer();
            result.textContent = `‚úÖ Letztes Spiel beendet in ${((Date.now()-startTime)/1000).toFixed(2)}s`;
            nextBtn.style.display = "none";
          }
        }
      };
      grid.appendChild(b);
    }
    sortBtn.style.display = "none";
    current = 1;
  };
}

// ---------- Steuerung ----------
nextBtn.onclick = () => {
  stage++;
  startTime = null;
  stopTimer();
  if (stage === 1) stage1();
  else if (stage === 2) stage2();
  else if (stage === 3) stage3();
  else if (stage === 4) stage4();
  else { stage = 0; stage0(); }
};

// Start
stage0();
</script>

</body>
</html>
